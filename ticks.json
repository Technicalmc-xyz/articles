[{"children":[{"text":"A tick is a part of the game loop where the game logic is processed."}],"id":1625922282818,"type":"p"},{"children":[{"text":"Many different things are done in a tick, and some of them a grouped in \"tick phases.\""}],"id":1625923698741,"type":"p"},{"children":[{"text":"Some of them are, in this order:"}],"id":1625923698763,"type":"p"},{"children":[{"text":""}],"id":1625923687264,"type":"p"},{"children":[{"text":"-Tick world border"}],"id":1625923687556,"type":"p"},{"children":[{"text":"-Process weather"}],"id":1625922287197,"type":"p"},{"children":[{"text":"-Increment world time"}],"id":1625922287200,"type":"p"},{"children":[{"text":"-Process functions and datapacks"}],"id":1625922287202,"type":"p"},{"children":[{"text":""}],"id":1626034834601,"type":"p"},{"children":[{"text":"runServer()"}],"id":1626034834743,"type":"h1"},{"children":[{"children":[{"text":"net.minecraft.server.MinecraftServer.runServer"}],"id":1626034929717,"type":"code_line"}],"id":1626034931228,"type":"code_block"},{"children":[{"text":"This is the main server loop.\n"}],"id":1626034906394,"type":"p"},{"children":[{"text":"The main loop:"}],"id":1626034960760,"type":"p"},{"children":[{"children":[{"children":[{"text":"Initialize the loop"}],"id":1626034969492,"type":"lic"}],"id":1626034972853,"type":"li"},{"children":[{"children":[{"text":"If the server is running, check if the server can keep up (<=50mspt), and if it can't (>50mspt) log a warning."}],"id":1626034978560,"type":"lic"}],"id":1626034978560,"type":"li"},{"children":[{"children":[{"text":"Create a new tick monitor"}],"id":1626035083616,"type":"lic"}],"id":1626035083616,"type":"li"},{"children":[{"children":[{"text":"Start the tick"}],"id":1626035091084,"type":"lic"}],"id":1626035091083,"type":"li"},{"children":[{"children":[{"text":"Call "},{"code":true,"text":"net.minecraft.server.MinecraftServer.tick"}],"id":1626035094923,"type":"lic"}],"id":1626035094923,"type":"li"},{"children":[{"children":[{"text":"Wait for the next tick"}],"id":1626035130433,"type":"lic"}],"id":1626035130433,"type":"li"},{"children":[{"children":[{"text":"End the tick and stop the tick monitor"}],"id":1626035135952,"type":"lic"}],"id":1626035135952,"type":"li"}],"id":1626034972843,"type":"ol"},{"children":[{"text":""}],"id":1626035145036,"type":"p"},{"children":[{"text":"If an exception occurs this loop will shut down the server and try to create and save a crash report."}],"id":1626035150454,"type":"p"},{"children":[{"text":"This will also create the main game thread."}],"id":1626035157328,"type":"p"},{"children":[{"text":""}],"id":1626035195270,"type":"p"},{"children":[{"text":"MinecraftServer.tick()"}],"id":1626035178168,"type":"h1"},{"children":[{"children":[{"text":"net.minecraft.server.MinecraftServer.tick"}],"id":1626035202403,"type":"code_line"}],"id":1626035206447,"type":"code_block"},{"children":[{"text":"This method is called in runServer()"}],"id":1626034951869,"type":"p"},{"children":[{"children":[{"children":[{"text":"Basic tick initialization:\nIncrease the number of ticks by one\nGet the time of the start of the tick"}],"id":1626035238770,"type":"lic"}],"id":1626035276883,"type":"li"},{"children":[{"children":[{"text":"Call "},{"code":true,"text":"net.minecraft.server.MinecraftServer.tickWorlds"}],"id":1626035293175,"type":"lic"}],"id":1626035293175,"type":"li"},{"children":[{"children":[{"text":"Player managing"}],"id":1626035324359,"type":"lic"}],"id":1626035324359,"type":"li"},{"children":[{"children":[{"text":"Autosave if the tick number is divisible by 6000"}],"id":1626035331734,"type":"lic"}],"id":1626035331734,"type":"li"},{"children":[{"children":[{"text":"Update snooper if tick number is divisible by 6000"}],"id":1626035368884,"type":"lic"}],"id":1626035368884,"type":"li"},{"children":[{"children":[{"text":"Calculate length of tick in milliseconds"}],"id":1626035387477,"type":"lic"}],"id":1626035387477,"type":"li"}],"id":1626035276876,"type":"ol"},{"children":[{"text":""}],"id":1626035408584,"type":"p"},{"children":[{"text":"tickWorlds()"}],"id":1626035410296,"type":"h1"},{"children":[{"children":[{"text":"net.minecraft.server.MinecraftServer.tickWorlds"}],"id":1626035416836,"type":"code_line"}],"id":1626035421261,"type":"code_block"},{"children":[{"text":"This method is called in MinecraftServer.tick()"}],"id":1626035450495,"type":"p"},{"children":[{"children":[{"children":[{"text":"Call the command function manager"}],"id":1626035524082,"type":"lic"}],"id":1626035662224,"type":"li"},{"children":[{"children":[{"text":"Sync world time with other dimensions every 20 ticks (1 second)"}],"id":1626035687209,"type":"lic"}],"id":1626035687209,"type":"li"},{"children":[{"children":[{"text":"Call "},{"code":true,"text":"net.minecraft.server.ServerWorld.tick"},{"text":", which is the main in-game loop"}],"id":1626035706042,"type":"lic"}],"id":1626035706041,"type":"li"},{"children":[{"children":[{"text":"Tick networkIO"}],"id":1626035758247,"type":"lic"}],"id":1626035758246,"type":"li"},{"children":[{"children":[{"text":"Update player latency"}],"id":1626035773203,"type":"lic"}],"id":1626035773203,"type":"li"},{"children":[{"children":[{"text":"Refresh server GUI"}],"id":1626035786516,"type":"lic"}],"id":1626035786516,"type":"li"}],"id":1626035662199,"type":"ol"},{"children":[{"text":""}],"id":1626035801536,"type":"p"},{"children":[{"text":"ServerWorld.tick()"}],"id":1626035802506,"type":"h1"},{"children":[{"children":[{"text":"net.minecraft.server.ServerWorld.tick"}],"id":1626035820128,"type":"code_line"}],"id":1626035824035,"type":"code_block"},{"children":[{"text":"This method is called in MinecraftServer.tickWorlds()"}],"id":1626035839551,"type":"p"},{"children":[{"children":[{"children":[{"text":"Tick world Border"}],"id":1626035857639,"type":"lic"}],"id":1626035941820,"type":"li"},{"children":[{"children":[{"text":"Weather:\nRain\nThunder\nPlayer sleeping"}],"id":1626035952116,"type":"lic"}],"id":1626035952116,"type":"li"},{"children":[{"children":[{"text":"Chunks:\nPurge unloaded chunks\nTACS stuff (?)\nUpdate chunk load levels\nNatural mob spawning\nMob spawning by ticking spawners\nRandom ticks\nPlayer movement\nWrite POIs\nUnload chunks\nInitialize chunk cache"}],"id":1626036001519,"type":"lic"}],"id":1626036001519,"type":"li"}],"id":1626035941791,"type":"ol"},{"children":[{"text":""}],"id":1626036332837,"type":"p"},{"children":[{"text":"World Border"}],"id":1626036333792,"type":"h2"},{"children":[{"code":true,"text":"net.minecraft.world.border.WorldBorder.tick"},{"text":" is called in the game loop. The only thing that will happen during this \"ticking\" of the world border is checking if the world border needs to change in size, and executing that."}],"id":1626036394775,"type":"p"},{"children":[{"text":""}],"id":1626036447576,"type":"h1"},{"children":[{"text":"Weather Cycle"}],"id":1626036456860,"type":"h2"},{"children":[{"text":"In the weather section of the tick function there are 6 variable allocations."}],"id":1626036470829,"type":"p"},{"children":[{"text":"The first one is a variable you get from a function that decides if it’s raining or not from rain gradient (the sky colour, but more later on this). The other variables are clearWeatherTime, rainTime, thunderTime, isRaining and isThundering from the world properties."}],"id":1626036486611,"type":"p"},{"children":[{"text":"\n"}],"id":1626036486622,"type":"p"},{"children":[{"text":"The first part of the code is an if block that checks if "},{"code":true,"text":"clearWeatherTime"},{"text":" is bigger than 0. This part is basically a hackfix to make it so that the weather will stay clear for a certain amount of time when the "},{"code":true,"text":"/weather clear [time]"},{"text":" command is used. In this block "},{"code":true,"text":"clearWeatherTime"},{"text":" will count down. After this "},{"code":true,"text":"thunderTime"},{"text":" and "},{"code":true,"text":"rainTime"},{"text":" will be set to 1 if it’s not thundering or raining respectively. If it is thundering or raining they will be set to 0. After this "},{"code":true,"text":"thundering"},{"text":" and "},{"code":true,"text":"raining"},{"text":" will be set to false in the properties."}],"id":1626036486632,"type":"p"},{"children":[{"text":"What this accomplishes will be that once "},{"code":true,"text":"clearWeatherTime"},{"text":" has reached 0, it will start raining and thundering the next tick."}],"id":1626036486646,"type":"p"},{"children":[{"text":"\n"}],"id":1626036486656,"type":"p"},{"children":[{"text":"If "},{"code":true,"text":"clearWeatherTime"},{"text":" isn’t bigger than 0, "},{"code":true,"text":"thunderTime"},{"text":" and "},{"code":true,"text":"rainTime"},{"text":" will be checked."}],"id":1626036486667,"type":"p"},{"children":[{"text":"If "},{"code":true,"text":"thunderTime"},{"text":" is bigger than 0 we’ll check if "},{"code":true,"text":"thunderTime - 1"},{"text":" is equal to 0. If that is the case, then "},{"code":true,"text":"thundering"},{"text":" will be reversed. This means if it was thundering, it will stop thundering and if it wasn’t thundering it will start thundering."}],"id":1626036486678,"type":"p"},{"children":[{"text":"If however "},{"code":true,"text":"thunderTime"},{"text":" isn’t bigger than 0, a new value is set for thunder time. This value is decided by:"}],"id":1626036486688,"type":"p"},{"children":[{"children":[{"text":"thunderTime = thundering ? this.random.nextInt(12000) + 3600 : this.random.nextInt(168000) + 12000;"}],"id":1626036802843,"type":"code_line"}],"id":1626036802855,"type":"code_block"},{"children":[{"text":"\n"}],"id":1626036486698,"type":"p"},{"children":[{"text":"In a more readable format, this will mean that:"}],"id":1626036486709,"type":"p"},{"children":[{"text":"If it is thundering, the new "},{"code":true,"text":"thunderTime"},{"text":"  will be between 3 600 and 15 600."}],"id":1626036486721,"type":"p"},{"children":[{"text":"If it is not thundering, the new "},{"code":true,"text":"thunderTime"},{"text":"  will be between 12 000 and 180 000."}],"id":1626036486731,"type":"p"},{"children":[{"text":"Which value somewhere in this range it becomes is determined by a random factor."}],"id":1626036486741,"type":"p"},{"children":[{"text":"\n"}],"id":1626036486750,"type":"p"},{"children":[{"text":"The same process happens for "},{"code":true,"text":"rainTime"},{"text":", though the new value for "},{"code":true,"text":"rainTime"},{"text":" is determined differently:"}],"id":1626036486760,"type":"p"},{"children":[{"children":[{"text":"rainTime = propertiesRaining ? this.random.nextInt(12000) + 12000 : this.random.nextInt(168000) + 12000;"}],"id":1626036882078,"type":"code_line"}],"id":1626036882104,"type":"code_block"},{"children":[{"text":"\n\n"}],"id":1626036486770,"type":"p"},{"children":[{"text":"In a more readable format, this will mean that:"}],"id":1626036486780,"type":"p"},{"children":[{"text":"If it is thundering, the new "},{"code":true,"text":"rainTime"},{"text":" will be between 12 000 and 24 000."}],"id":1626036486794,"type":"p"},{"children":[{"text":"If it is not thundering, the new "},{"code":true,"text":"rainTime"},{"text":" will be between 12 000 and 180 000."}],"id":1626036486803,"type":"p"},{"children":[{"text":"Which value somewhere in this range it becomes is determined by a random factor."}],"id":1626036486813,"type":"p"},{"children":[{"text":"After this the values that were changed will be reallocated to the corresponding fields."}],"id":1626036486822,"type":"p"},{"children":[{"text":"\n"}],"id":1626036486832,"type":"p"},{"children":[{"text":"So now for the explanation of how this actually works. The way in which this works is a little confusing "},{"code":true,"text":"clearWeatherTime"},{"text":" isn’t used to determine how long the weather will stay clear outside of commands. Instead what happens is:"}],"id":1626036486842,"type":"p"},{"children":[{"text":"The game starts and "},{"code":true,"text":"clearWeatherTime"},{"text":", "},{"code":true,"text":"rainTime"},{"text":" and "},{"code":true,"text":"thunderTime"},{"text":" are set to 0. "},{"code":true,"text":"raining"},{"text":" and "},{"code":true,"text":"thundering"},{"text":"  are set to false. Now, since everything is set to 0 it will immediately go to the part where it sets the timers, using the formulas we’ve just seen. In this case "},{"code":true,"text":"rainTime"},{"text":" and "},{"code":true,"text":"thunderTime"},{"text":" will be used to indicate how long it will "},{"bold":true,"text":"not"},{"text":" be raining or thundering. Both timers will count down, and only when they have reached 0 it will start raining or thundering, depending on which timer ran out. It will start this weather by flipping the boolean as we’ve seen before. After this a new time will be set for "},{"code":true,"text":"rainTime"},{"text":" or "},{"code":true,"text":"thunderTime"},{"text":". This time, they’ll be used to indicate how long it will be raining or thundering. By constantly flipping the time "},{"code":true,"text":"rainTime"},{"text":" and "},{"code":true,"text":"thunderTime"},{"text":" represent, there’s no need to use "},{"code":true,"text":"clearWeatherTime"},{"text":". Thus we only have a value for this if we want to force the game to keep the weather clear for a certain amount of time no matter what."}],"id":1626036486855,"type":"p"},{"children":[{"text":"\n\n"}],"id":1626036486866,"type":"p"},{"children":[{"text":"Tile tick phase"}],"id":1625922504011,"type":"h2"},{"children":[{"text":""},{"children":[{"text":"Tile ticks"}],"id":1625922504015,"type":"a","url":"https://technicalmc.xyz/article/view/tile_ticks"},{"text":" are processed in this phase.The game select tile ticks which have their processing tick (current tick when scheduled+ delay)  smaller or equal to the current tick."}],"id":1625922504015,"type":"p"},{"children":[{"text":""}],"id":1626082392424,"type":"p"},{"children":[{"text":"maximum 65536 tile ticks can be processed per tick,if there is more to process,the last tile tick will be delayed to the next tick"}],"id":1626082393186,"type":"p"},{"children":[{"text":"Block tileticks an fluid tileticks are proecessed one after the other,with each their own tile tick cap.\n\n"}],"id":1626082310196,"type":"p"},{"children":[{"text":""}],"id":1625922569020,"type":"p"},{"children":[{"text":"-Handle raids"}],"id":1625922287224,"type":"p"},{"children":[{"text":""}],"id":1625918026190,"type":"p"},{"children":[{"text":"Chunk Manager tick"}],"id":1625922570198,"type":"h2"},{"children":[{"text":"(just before block events since 1.17.1, was before tileticks)"}],"id":1625922908131,"type":"p"},{"children":[{"text":""}],"id":1626082503100,"type":"p"},{"children":[{"text":"-Handle chunk loading and unloading tickets"}],"id":1625922904170,"type":"p"},{"children":[{"text":"-send chunk packets like block changes "}],"id":1625923042017,"type":"p"},{"children":[{"text":"-Do natural mob spawning\n-Mob spawning by ticking spawners"}],"id":1625922904174,"type":"p"},{"children":[{"text":"-Handle lightning, ice and snow"}],"id":1625922904176,"type":"p"},{"children":[{"text":"-Do random ticks\n-Player movement"}],"id":1625922904180,"type":"p"},{"children":[{"text":"-Tick POI’s"}],"id":1625922904184,"type":"p"},{"children":[{"text":"-Unload chunks\n-Initialize chunk cache"}],"id":1625922904187,"type":"p"},{"children":[{"text":"\n\n"}],"id":1625922904191,"type":"p"},{"children":[{"text":"Block event phase"}],"type":"h2"},{"children":[{"text":"Block events are processed in this phase. This includes things such as:"}]},{"children":[{"children":[{"children":[{"text":""},{"children":[{"text":"piston"}],"id":1625918144005,"type":"a","url":"https://technicalmc.xyz/article/view/piston"},{"text":" extension/retraction"}],"type":"lic"}],"type":"li"},{"children":[{"children":[{"text":"noteblock play note"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"chest/endercher/shulker open/close (change open count)"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"bell updating villagers when hit"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"gateway start cooldown"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"mobspawner reset delay"}],"type":"p"}],"type":"li"}],"type":"ul"},{"children":[{"text":"Block events are stored in a LinkedHashSet. The game loops through block events and processes them. Piston block events can activate and schedule another block event that is added a the end of the LinkedHashSet.This allow chaining multiple blockevents in the same tick.\n"}]},{"children":[{"text":"Blockevents are sent directly to the client the execute them also clientside."}]},{"children":[{"text":""}]},{"children":[{"text":""}],"type":"p"},{"children":[{"text":"-Handle ender dragon fight"}],"id":1625922557605,"type":"p"},{"children":[{"text":""}]},{"children":[{"text":"Regular entity phase"}],"type":"h2"},{"children":[{"text":"Regular entities are processed in this phase. This includes things such as:"}]},{"children":[{"children":[{"children":[{"text":"entities move"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"entities trigger tripwire hooks"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"entities trigger pressure plates."}],"type":"lic"}],"id":1625922600628,"type":"li"}],"type":"ul"},{"children":[{"text":""}],"id":1625922618086,"type":"p"},{"children":[{"text":"Tile entity phase"}],"type":"h2"},{"children":[{"text":"Tile entities are processed in this phase. This includes things such as:"}]},{"children":[{"children":[{"children":[{"text":""},{"children":[{"text":"moving blocks"}],"id":1625918206135,"type":"a","url":"https://technicalmc.xyz/article/view/moving_piston_block_36"},{"text":" turn into normal blocks"}],"type":"lic"}],"type":"li"},{"children":[{"children":[{"text":"moving blocks push entities"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"furnaces check for items in their inventory"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"hoppers push and pull"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"sculk sensors activate."}],"type":"p"}],"type":"li"}],"type":"ul"},{"children":[{"text":""}],"id":1625922620693,"type":"h1"},{"children":[{"text":"Player inputs phase"}],"type":"h1"},{"children":[{"text":"Player inputs are processed in this phase. This includes things such as:"}]},{"children":[{"children":[{"children":[{"text":"flipping levers"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"pushing buttons"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"placing blocks"}],"type":"p"}],"type":"li"},{"children":[{"children":[{"text":"breaking blocks"}],"type":"p"}],"type":"li"}],"type":"ul"},{"children":[{"text":""}],"id":1625918025768,"type":"p"}]